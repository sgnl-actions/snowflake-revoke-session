# yaml-language-server: $schema=https://raw.githubusercontent.com/sgnl-actions/schemas/main/metadata.schema.json
name: snowflake-revoke-session
description: Revoke all active sessions for a Snowflake user by disabling and re-enabling the account

# Input parameters for web form generation
inputs:
  username:
    type: text
    description: The Snowflake username to revoke sessions for
    required: true
    validation:
      min: 1
      max: 100

  delay:
    type: text
    description: Delay between disable and re-enable operations (e.g., 100ms, 1s)
    required: false
    validation:
      max: 50

  address:
    type: text
    description: Snowflake API base URL (e.g., https://api.snowflakecomputing.com)
    required: false
    validation:
      min: 1
      max: 255

# Expected output structure
outputs:
  username:
    type: text
    description: The Snowflake username that was processed

  sessionsRevoked:
    type: boolean
    description: Whether the sessions were successfully revoked

  userDisabled:
    type: text
    description: Statement handle or status for the disable operation

  userReEnabled:
    type: text
    description: Statement handle or status for the re-enable operation

  revokedAt:
    type: datetime
    description: When the revocation completed (ISO 8601)

# Secrets (configured at deployment time)
secrets:
  BEARER_AUTH_TOKEN:
    description: Snowflake API Bearer token (for Bearer authentication)
    required: false

  BASIC_USERNAME:
    description: Username for Basic authentication
    required: false

  BASIC_PASSWORD:
    description: Password for Basic authentication
    required: false

  OAUTH2_CLIENT_CREDENTIALS_CLIENT_SECRET:
    description: Client secret for OAuth2 Client Credentials flow
    required: false

  OAUTH2_AUTHORIZATION_CODE_ACCESS_TOKEN:
    description: Access token for OAuth2 Authorization Code flow
    required: false

environment:
  ADDRESS:
    description: Snowflake API base URL
    default: "https://api.snowflakecomputing.com"

  OAUTH2_CLIENT_CREDENTIALS_CLIENT_ID:
    description: Client ID for OAuth2 Client Credentials flow
    required: false

  OAUTH2_CLIENT_CREDENTIALS_TOKEN_URL:
    description: Token endpoint URL for OAuth2 Client Credentials flow
    required: false

  OAUTH2_CLIENT_CREDENTIALS_SCOPE:
    description: OAuth2 scopes for Client Credentials flow
    required: false

  OAUTH2_CLIENT_CREDENTIALS_AUDIENCE:
    description: OAuth2 audience for Client Credentials flow
    required: false

  OAUTH2_CLIENT_CREDENTIALS_AUTH_STYLE:
    description: OAuth2 auth style for Client Credentials flow
    required: false

# Runtime configuration
runtime:
  type: nodejs-22
  timeout: 30s
  memory: 128Mi